@page "/build"

@inject BlazorWasm.Client.Services.IBananaService BananaService
@inject BlazorWasm.Client.Services.IUnitService UnitService
@inject IToastService ToastService

<div class="form-group">
	<select @bind="selectedUnitId" class="form-control">
		@foreach (var unit in UnitService.Units)
		{ 
			<option value="@unit.Id">@unit.Title // @unit.Cost Bananas</option>
		}
	</select>
</div>

<button @onclick="() => BuildUnit()" class="btn btn-primary">Build</button>

@if (needMoreBananas)
{ 
	<div class="validation-message">
		Not Enough Bananas!
	</div>
}

@code {
	private bool needMoreBananas = false;

	private void EatBananas(int amount)
	{
		BananaService.EatBananas(amount);
	}

	private void EarnBananas(int amount)
	{
		BananaService.EarnBananas(amount);
	}

	int selectedUnitId = 1;
	private void BuildUnit()
	{
		BlazorWasm.Shared.Unit selectedUnit = UnitService.Units.FirstOrDefault(UnitService => UnitService.Id == selectedUnitId);
		if (BananaService.Bananas < selectedUnit.Cost)
		{
			needMoreBananas = true;
			ToastService.ShowError("Not Enough Bananas!", ":(");
			return;
		}
		BananaService.EatBananas(selectedUnit.Cost);
		UnitService.AddUnit(selectedUnitId);
	}
}
